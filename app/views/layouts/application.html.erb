<!DOCTYPE html>
<html lang="en">
  <head>
    <%= csrf_meta_tags %>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>On Course!</title>

    <%= stylesheet_link_tag 'application' %>
    <style type="text/css">
    #myCanvas{
      background-color: #D1C860;
    }
    </style>
    <script src="//code.createjs.com/easeljs-0.8.0.min.js"></script>
    <script>

    var stageWidth = 1000;
    var stageHeight = 800;
    var stage;
    var update = true;
    var shape2;
    var rotate_clockwise;
    var img;
    var rotdegr = 3;

    function init(){

      //new stage
      stage = new createjs.Stage(document.getElementById("myCanvas"));
      stage.enableMouseOver();

      //rectangle
      shape2 = new createjs.Shape();
      shape2.graphics.beginFill(createjs.Graphics.getRGB(255,0,0));
      shape2.graphics.rect(0,0,100,10);
      shape2.regX = 200;
      shape2.regY = 30;
      shape2.x = stageWidth/2 - 150;
      shape2.y = stageHeight/2;
      stage.autoClear = true;
      stage.enableDOMEvents(true);
      createjs.Touch.enable(stage);
      createjs.Ticker.setFPS(30);
      shape2.snapToPixel = true;
      shape2.mouseEnabled = true;
      shape2.alpha = 0.7;
      shape2.addEventListener("mousedown", handleMouseDown);
      stage.addEventListener("stagemouseup", handleMouseUp);
      stage.update();
      // using "on" binds the listener to the scope of the currentTarget by default
      // in this case that means it executes in the scope of the button.
      shape2.on("mousedown", function (evt) {
        this.parent.addChild(this);
        this.offset = {x: this.x - evt.stageX, y: this.y - evt.stageY};
      });

      // the pressmove event is dispatched when the mouse moves after a mousedown on the target until the mouse is released.
      shape2.on("pressmove", function (evt) {
        this.x = evt.stageX + this.offset.x;
        this.y = evt.stageY + this.offset.y;
        // indicate that the stage should be updated on the next tick:
        update = true;
      });
      stage.addChild(shape2);

      //draw to the canvas
      // stage.update();
      createjs.Ticker.addEventListener("tick",tick);

      // // rotate element
      // img = new Image();
      // img.onload = setupCanvas;
      // img.src = "images/rotate_clockwise.png";

    }


    function pressHandler(e){
      e.onMouseMove = function(ev){
        e.target.x = ev.stageX;
        e.target.y = ev.stageY;
        update = true;
      }
    }

    function tick(event) {
      // this set makes it so the stage only re-renders when an event handler indicates a change has happened.
      if (update) {
        update = false; // only update once
        stage.
        stage.update(event);
      }
    }

    function stop() {
      createjs.Ticker.removeEventListener("tick", tick);
    }

    function handleMouseDown(event) {
      stage.addEventListener("stagemousemove" , handleMouseMove);
    }

    function handleMouseMove(event) {
      rotateWheel(1);
    }

    function rotateWheel(type){
      if(type > 0){
        //clockwise
        shape2.rotation = shape2.rotation + rotdegr;
      }else if(type < 0){
        //anti clockwise
        shape2.rotation = shape2.rotation - rotdegr;
      }
      stage.update();
    }

    function handleMouseUp(event) {
      stage.removeEventListener("stagemousemove" , handleMouseMove);
    }

    </script>
  </head>

  <body <% if request.fullpath == '/' %> class="home-page" <% end %>>
    <nav class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="navbar-brand"><%= link_to "On Course!", root_path %></div>
        </div>
        <div class= "navbar-collapse collapse">
          <ul class="navbar-form navbar-right" role="form">
            <li class= "list list-unstyled">

            <% if current_user %>
              <%= link_to ("Hello, #{current_user.first_name} #{current_user.last_name} !"), dashboard_path %>
              |
              <%= link_to "Sign Out", signout_path, class: "btn btn-primary" %>

            <% else %>
              <%= form_tag signin_path do |f| %>
              <% if @sign_in_error %>
                <div class= "text-danger">
                  <font size= "3">
                    <%= @sign_in_error %>
                  </font>
                </div>
              <% end %>

              <div class="form-group">
                <%= email_field_tag :email, "", class: "form-control", placeholder: "Email" %>
              </div>
              <div class="form-group">
                <%= password_field_tag :password, "", class: "form-control", placeholder: "Password" %>
              </div>
              <%= submit_tag "Sign in",  class: "btn btn-success" %>
              <%= link_to 'Sign Up', signup_path, class: "btn btn-primary"%>
            <% end %>
            <% end %></li>
          </ul>
        </div>
      </nav>
    <div class="page">
      <%= yield %>
    </div>
     <!-- FOOTER -->
     <footer class="footer">
      <div class="container">
        <p class="pull-right"><a href="#">Back to top</a></p>
        <p>&copy; 2014 Company, Inc. &middot; <a href="#">Privacy</a> &middot; <a href="#">Terms</a></p>
      </div>
     </footer>

   </div><!-- /.container -->


 <%= javascript_include_tag 'application' %>
 </body>
</html>
